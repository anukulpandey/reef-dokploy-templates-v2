services:
  reef-run-local:
    image: anukulpandey/reef-chain-node:latest
    container_name: reef-run-local
    working_dir: /workspace

    volumes:
      - ./:/workspace

    ports:
      - "30335:30335"
      - "30333:30333"
      - "30334:30334"
      - "30336:30336"
      - "9944:9944"
      - "9945:9945"
      - "9946:9946"

    entrypoint: /bin/sh
    command: -c "
      set -e &&

      echo 'ðŸ“¥ Downloading Makefile...' &&
      wget -q -O /workspace/Makefile \
        https://raw.githubusercontent.com/anukulpandey/reef-dokploy-templates-v2/refs/heads/master/reef-cluster/Makefile &&

      echo 'ðŸ“¦ Installing required tools...' &&
      apt-get update &&
      apt-get install -y make wget curl jq &&

      echo 'ðŸ”§ Preparing fake build output...' &&
      mkdir -p target/release &&
      ln -sf /usr/local/bin/reef-node target/release/reef-node &&

      echo 'ðŸš€ Running make run-local...' &&
      make run-local"